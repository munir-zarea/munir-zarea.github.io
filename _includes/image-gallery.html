{% assign image_paths = include.images | split: ", " %}
{% assign gallery_height = include.height | default: "300" %}
{% assign sizes = include.sizes | split: "" %}

<style>
  .image-gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin: 1em auto;          /* center the gallery block */
    justify-content: center;   /* center items in each row */
    max-width: 1100px;         /* <= adjust this to taste */
    width: 100%;
  }

  .image-gallery-item {
    flex: 0 1 calc(50% - 16px);   /* 2 images per row, but don't force-grow */
    max-width: calc(50% - 16px);
    box-sizing: border-box;
    display: flex;                /* center image inside the cell */
    justify-content: center;
  }

  @media (max-width: 768px) {
    .image-gallery {
      max-width: 100%;
    }

    .image-gallery-item {
      flex: 0 1 100%;
      max-width: 100%;
    }
  }

  .image-gallery-item img {
    display: block;
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    object-fit: contain;
    max-height: {{ gallery_height }}px;

    /* optional: if you want images not to stretch to fill the 50% column */
    width: auto;
  }

  .gallery-caption {
    font-size: 0.9em;
    color: #555;
    text-align: center;
    margin-top: 0.5em;
  }
</style>


<div class="image-gallery">
  {% for image_path in image_paths %}
    {% assign image_name = image_path | strip %}
    <div class="image-gallery-item">
      <img 
        src="{{ image_name }}" 
        alt="{{ image_name | split: '/' | last }}" 
        loading="lazy"
        style="
          {% if sizes[forloop.index0] %}
          max-height: {{ sizes[forloop.index0] }}px;
          {% else %}
          max-height: {{ gallery_height }}px;
          {% endif %}
        "
        onerror="this.onerror=null;this.src=this.src.replace('.webp','.png').replace('.png','.webp');"
      />
    </div>
  {% endfor %}
</div>

{% if include.caption and include.caption != "" %}
  <div class="gallery-caption">{{ include.caption }}</div>
{% endif %}

